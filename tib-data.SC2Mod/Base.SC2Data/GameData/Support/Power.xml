<Catalog>




    <CBehaviorBuff id="MaximumPowerCnC" default="1">
        <EditorCategories value="Race:Genetron,AbilityorEffectType:Units"/>
        <DisableValidatorArray value="CasterNotLockedDown"/>
        <DisableValidatorArray value="CasterIsNotUnderConstruction"/>
        <DisableValidatorArray value="CasterIsNotHidden"/>
        <DisableValidatorArray value="NotHidden"/>
        <RemoveValidatorArray value="CasterNotDead"/>
        <RemoveValidatorArray value="GenetronUnitOwnerNotChanged"/>
        <MaxStackCount value="0"/>
        <Modification>
            <VitalMaxIncreaseAffectsCurrentArray index="Energy" value="0"/>
        </Modification>
        <!--        <InfoFlags index="Hidden" value="1"/>-->
    </CBehaviorBuff>
    <CEffectUserData id="MirrorGenetronPowerSupplyCnCData" default="1">
        <?token id="level"?>
        <Amount value="0">
            <AccumulatorArray value="MaximumPowerCnC##level##Arith"/>
        </Amount>
        <Operation value="Set"/>
        <ValidateMax value="500000"/>
        <EffectSuccess value="MirrorGenetronPowerSupplyCnC##level##AB"/>
        <EffectFailure value="MirrorGenetronPowerSupplyCnC##level##RBSet"/>
    </CEffectUserData>
    <CEffectApplyBehavior id="MirrorGenetronPowerSupplyCnCAB" default="1">
        <?token id="level"?>
        <WhichUnit Value="Caster"/>
        <Behavior value="MaximumPowerCnC##level##"/>
        <Count value="0">
            <AccumulatorArray value="DefaultDataAdd"/>
        </Count>
    </CEffectApplyBehavior>
    <CEffectSet id="MirrorGenetronPowerSupplyCnCRBSet" default="1">
        <?token id="level"?>
        <EffectArray value="MirrorGenetronPowerSupplyCnC##level##RB"/>
        <EffectArray value="MirrorGenetronPowerSupplyCnC##level##Data"/>
    </CEffectSet>
    <CEffectRemoveBehavior id="MirrorGenetronPowerSupplyCnCRB" default="1">
        <?token id="level"?>
        <WhichUnit Value="Caster"/>
        <BehaviorLink value="MaximumPowerCnC##level##"/>
    </CEffectRemoveBehavior>
    <CAccumulatorArithmetic id="MaximumPowerCnCArith" default="1">
        <?token id="level"?>
        <Parameters value="0">
            <AccumulatorArray value="MaximumPowerCnC##level##StackTarget"/>
        </Parameters>
        <Parameters value="0">
            <AccumulatorArray value="MaximumPowerCnC##level##StackCaster"/>
        </Parameters>
        <Operation value="Subtract"/>
    </CAccumulatorArithmetic>


    <!--+25Max -->
    <CEffectUserData id="MirrorGenetronPowerSupplyCnC25Data" parent="MirrorGenetronPowerSupplyCnCData" level="25"/>
    <CEffectApplyBehavior id="MirrorGenetronPowerSupplyCnC25AB" level="25" parent="MirrorGenetronPowerSupplyCnCAB"/>
    <CEffectSet id="MirrorGenetronPowerSupplyCnC25RBSet" level="25" parent="MirrorGenetronPowerSupplyCnCRBSet"/>
    <CEffectRemoveBehavior id="MirrorGenetronPowerSupplyCnC25RB" level="25" parent="MirrorGenetronPowerSupplyCnCRB"/>
    <CBehaviorBuff id="MaximumPowerCnC25" parent="MaximumPowerCnC"><Modification><VitalMaxArray index="Energy" value="25"/></Modification></CBehaviorBuff>
    <CAccumulatorArithmetic id="MaximumPowerCnC25Arith" parent="MaximumPowerCnCArith" level="25"/>
    <CAccumulatorBehavior id="MaximumPowerCnC25StackTarget"><Behavior value="MaximumPowerCnC25"/><UnitSource Value="Target"/></CAccumulatorBehavior>
    <CAccumulatorBehavior id="MaximumPowerCnC25StackCaster"><Behavior value="MaximumPowerCnC25"/></CAccumulatorBehavior>
    <CEffectApplyBehavior id="TrackGenetronPowerSupplyCnC25AB"><Behavior value="MaximumPowerCnC25"/></CEffectApplyBehavior>

    <!--+100Max -->
    <CEffectUserData id="MirrorGenetronPowerSupplyCnC100Data" parent="MirrorGenetronPowerSupplyCnCData" level="100"/>
    <CEffectApplyBehavior id="MirrorGenetronPowerSupplyCnC100AB" level="100" parent="MirrorGenetronPowerSupplyCnCAB"/>
    <CEffectSet id="MirrorGenetronPowerSupplyCnC100RBSet" level="100" parent="MirrorGenetronPowerSupplyCnCRBSet"/>
    <CEffectRemoveBehavior id="MirrorGenetronPowerSupplyCnC100RB" level="100" parent="MirrorGenetronPowerSupplyCnCRB"/>
    <CBehaviorBuff id="MaximumPowerCnC100" parent="MaximumPowerCnC"><Modification><VitalMaxArray index="Energy" value="100"/></Modification></CBehaviorBuff>
    <CAccumulatorArithmetic id="MaximumPowerCnC100Arith" parent="MaximumPowerCnCArith" level="100"/>
    <CAccumulatorBehavior id="MaximumPowerCnC100StackTarget"><Behavior value="MaximumPowerCnC100"/><UnitSource Value="Target"/></CAccumulatorBehavior>
    <CAccumulatorBehavior id="MaximumPowerCnC100StackCaster"><Behavior value="MaximumPowerCnC100"/></CAccumulatorBehavior>
    <CEffectApplyBehavior id="TrackGenetronPowerSupplyCnC100AB"><Behavior value="MaximumPowerCnC100"/></CEffectApplyBehavior>


    <CEffectCreateHealer id="CnCPowerHealer" default="1">
        <ValidatorArray value="GenetronEnergyGenValidators"/>
        <Flags index="Channeled" value="0"/>
        <Flags index="ContinueWhenFull" value="1"/>
        <PeriodicValidator value="GenetronEnergyGenValidators"/>
        <RechargeVital value="Energy"/>
        <InitialEffect value="DataDefaultSet1"/>
        <FinalEffect value="DataDefaultSet0"/>
    </CEffectCreateHealer>
    <!--0.24 per second ~ 5 Energy Points (ConsructionYard) -->
    <CEffectCreateHealer id="CnCPowerHealer005" parent="CnCPowerHealer">
        <RechargeVitalRate value="0.2383"/>
    </CEffectCreateHealer>
    <!--0.71 per second ~ 15 Energy Points (PowerPlant) -->
    <CEffectCreateHealer id="CnCPowerHealer015" parent="CnCPowerHealer">
        <RechargeVitalRate value="0.7148"/>
    </CEffectCreateHealer>
    <!--1.43 per second ~ 30 Energy Points (Upgraded PowerPlant) -->
    <CEffectCreateHealer id="CnCPowerHealer030" parent="CnCPowerHealer">
        <RechargeVitalRate value="1.4298"/>
    </CEffectCreateHealer>
    <CEffectEnumTrackedUnits id="CnCPowerETU" default="1">
        <?token id="level"?>
        <ValidatorArray value="CasterDataDefaultIs0"/>
        <ValidatorArray value="CasterNotLockedDown"/>
        <ValidatorArray value="CasterIsNotHidden"/>
        <ValidatorArray value="CasterNotDead"/>
        <ValidatorArray value="CasterIsNotUnderConstruction"/>
        <BehaviorLink value="GenetronPowerSupplyTracker"/>
        <Effect value="CnCPowerHealer##level##"/>
    </CEffectEnumTrackedUnits>
    <CEffectEnumTrackedUnits id="CnCPowerETU030" parent="CnCPowerETU" level="030"/>
    <CEffectEnumTrackedUnits id="CnCPowerETU015" parent="CnCPowerETU" level="015"/>
    <CEffectEnumTrackedUnits id="CnCPowerETU005" parent="CnCPowerETU" level="005"/>


    <!-- <CBehaviorBuff id="CnCPowerSupply100"/>
    <CBehaviorBuff id="CnCPowerSupply25"/> -->
    <!-- <CValidatorUnitCompareBehaviorCount id="HasCnCPowerSupply100">
        <WhichUnit Value="Caster"/>
        <Value value="1"/>
        <Behavior value="CnCPowerSupply100"/>
    </CValidatorUnitCompareBehaviorCount>
    <CValidatorUnitCompareBehaviorCount id="HasCnCPowerSupply25">
        <WhichUnit Value="Caster"/>
        <Value value="1"/>
        <Behavior value="CnCPowerSupply25"/>
    </CValidatorUnitCompareBehaviorCount> -->

    
    <CValidatorUnitType id="CasterIsNodPowerPlant">
        <WhichUnit Value="Caster"/>
        <Value value="NodPowerPlant"/>
    </CValidatorUnitType>
    <CValidatorUnitType id="CasterIsNodConstructionYard">
        <WhichUnit Value="Caster"/>
        <Value value="NodConstructionYard"/>
    </CValidatorUnitType>

    
    <CValidatorCombine id="HasCnCPowerSupply100">
        <CombineArray value="CasterIsNodPowerPlant"/>
    </CValidatorCombine>
    <CValidatorCombine id="HasCnCPowerSupply25">
        <CombineArray value="CasterIsNodConstructionYard"/>
    </CValidatorCombine>

    



    <CBehaviorBuff id="CnCPowerGeneration" default="1">
        <?token id="level"?>
<!--        <InfoFlags index="Hidden" value="1"/>-->
        <InfoIcon value="Assets\Textures\btn-tips-computerterminals.dds"/>
        <EditorCategories value="Race:Genetron,AbilityorEffectType:Units"/>
        <DisableValidatorArray value="NotUnderConstruction"/>
        <DisableValidatorArray value="StructureNotLockedDown"/>
        <DisableValidatorArray value="CasterIsNotHidden"/>
        <DisableValidatorArray value="CasterDataDefaultIs0"/>
        <Period value="0.5"/>
        <InitialEffect value="CnCPowerETU##level##"/>
        <PeriodicEffect value="CnCPowerETU##level##"/>
    </CBehaviorBuff>
    <CBehaviorBuff parent="CnCPowerGeneration" id="CnCPowerGeneration030" level="030"/>
    <CBehaviorBuff parent="CnCPowerGeneration"  id="CnCPowerGeneration015" level="015"/>
    <CBehaviorBuff parent="CnCPowerGeneration"  id="CnCPowerGeneration005" level="005"/>





    <CBehaviorBuff default="1" id="CNCEnergyDrain">
        <InitialEffect value="CNCEnergyDrainSet"/>
        <DisableValidatorArray value="GenetronPowerSupplyGE05"/>
        <Period value="0.125"/>
        <PeriodicEffect value="CNCEnergyDrainPowerEnum"/>
    </CBehaviorBuff>
    <CBehaviorBuff id="CNCEnergyDrain5" parent="CNCEnergyDrain"/>
    <CBehaviorBuff id="CNCEnergyDrain10" parent="CNCEnergyDrain"/>
    <CBehaviorBuff id="CNCEnergyDrain15" parent="CNCEnergyDrain"/>
    <CEffectSet id="CNCEnergyDrainSet">
        <EffectArray value="GenetronPowerSupplyTracker"/>
        <EffectArray value="TrackGenetronPowerSupplyUnit"/>
    </CEffectSet>
    <CEffectEnumTrackedUnits id="CNCEnergyDrainPowerEnum">
        <ValidatorArray value="CasterDataDefaultIs0"/>
        <BehaviorLink value="GenetronPowerSupplyTracker"/>
        <Effect value="CNCEnergyDrainPowerEnumPowerRateSwitch"/>
    </CEffectEnumTrackedUnits>
    <CEffectSwitch id="CNCEnergyDrainPowerEnumPowerRateSwitch">
        <CaseArray Validator="CNCEnergyDrain5" Effect="CNCEnergyDrainPowerEnumPowerRate5"/>
        <CaseArray Validator="CNCEnergyDrain10" Effect="CNCEnergyDrainPowerEnumPowerRate10"/>
        <CaseArray Validator="CNCEnergyDrain15" Effect="CNCEnergyDrainPowerEnumPowerRate15"/>
    </CEffectSwitch>
    <CEffectCreateHealer  id="CNCEnergyDrainPowerEnumPowerRate">
        <LaunchUnit Value="Target"/>
        <Flags index="Channeled" value="0"/>
        <Flags index="ContinueWhenFull" value="1"/>
        <!--        <PeriodicValidator value="CasterHasSubterraneanSensors"/>-->
        <DrainVital value="Energy"/>
        <DrainVitalCostFactor value="1"/>
<!--        <RechargeVitalRate value="0.2382"/>-->
<!--        <RechargeVitalRate value="2.1445"/>-->
        <InitialEffect value="DataDefaultSet1"/>
        <FinalEffect value="DataDefaultSet0"/>
    </CEffectCreateHealer>
    <CEffectCreateHealer id="CNCEnergyDrainPowerEnumPowerRate5" parent="CNCEnergyDrainPowerEnumPowerRate">
        <RechargeVitalRate value="0.2382"/>
    </CEffectCreateHealer>
    <CEffectCreateHealer id="CNCEnergyDrainPowerEnumPowerRate10" parent="CNCEnergyDrainPowerEnumPowerRate">
        <RechargeVitalRate value="0.4765"/>
    </CEffectCreateHealer>
    <CEffectCreateHealer id="CNCEnergyDrainPowerEnumPowerRate15" parent="CNCEnergyDrainPowerEnumPowerRate">
        <RechargeVitalRate value="0.7148"/>
    </CEffectCreateHealer>
    <CEffectCreateHealer id="CNCEnergyDrainPowerEnumPowerRate30" parent="CNCEnergyDrainPowerEnumPowerRate">
        <RechargeVitalRate value="1.4296"/>
    </CEffectCreateHealer>
    <CValidatorUnitCompareBehaviorCount id="CNCEnergyDrain5"><WhichUnit Value="Caster"/><Value value="1"/><Behavior value="CNCEnergyDrain5"/></CValidatorUnitCompareBehaviorCount>
    <CValidatorUnitCompareBehaviorCount id="CNCEnergyDrain10"><WhichUnit Value="Caster"/><Value value="1"/><Behavior value="CNCEnergyDrain10"/></CValidatorUnitCompareBehaviorCount>
    <CValidatorUnitCompareBehaviorCount id="CNCEnergyDrain15"><WhichUnit Value="Caster"/><Value value="1"/><Behavior value="CNCEnergyDrain15"/></CValidatorUnitCompareBehaviorCount>


    <CEffectSwitch id="TrackGenetronPowerSupplyEnergySwitch">
        <CaseArray Validator="HasCnCPowerSupply100" Effect="TrackGenetronPowerSupplyCnC100AB"/>
        <CaseArray Validator="HasCnCPowerSupply25" Effect="TrackGenetronPowerSupplyCnC25AB"/>
    </CEffectSwitch>
    <CEffectSet id="MirrorGenetronPowerSupplySet2">
        <EffectArray value="MirrorGenetronPowerSupplyProcessingCoreData"/>
        <EffectArray value="MirrorGenetronPowerSupplyCnC100Data"/>
        <EffectArray value="MirrorGenetronPowerSupplyCnC25Data"/>
    </CEffectSet>
    <CEffectSet id="MirrorGenetronPowerSupplyRBSet2">
        <EffectArray value="MirrorGenetronPowerSupplyProcessingCoreRB"/>
        <EffectArray value="MirrorGenetronPowerSupplyCnC100RB"/>
        <EffectArray value="MirrorGenetronPowerSupplyCnC25RB"/>
    </CEffectSet>
    <CEffectSet id="MirrorGenetronPowerSupplySet">
        <EffectArray index="1" value="MirrorGenetronPowerSupplySet2"/>
    </CEffectSet>
    <CEffectSet id="MirrorGenetronPowerSupplyRBSet">
        <EffectArray index="0" value="MirrorGenetronPowerSupplyRBSet2"/>
    </CEffectSet>

    
    <CValidatorUnitCompareOrderCount id="HasNodConstructionYardTrain"><AbilLink value="NodConstructionYardTrain"/></CValidatorUnitCompareOrderCount>
    <CValidatorUnitCompareOrderCount id="HasNodRefineryTrain"><AbilLink value="NodRefineryTrain"/></CValidatorUnitCompareOrderCount>
    <CValidatorUnitCompareOrderCount id="HasNodHandTrain"><AbilLink value="NodHandTrain"/></CValidatorUnitCompareOrderCount>
    <CValidatorUnitCompareOrderCount id="HasNodWarFactoryTrain"><AbilLink value="NodWarFactoryTrain"/></CValidatorUnitCompareOrderCount>
    <CValidatorUnitCompareOrderCount id="HasNodAirTowerTrain"><AbilLink value="NodAirTowerTrain"/></CValidatorUnitCompareOrderCount>
    <CValidatorUnitCompareOrderCount id="HasNodUpgradePowerPlant"><AbilLink value="NodUpgradePowerPlant"/></CValidatorUnitCompareOrderCount>



    <!-- <CValidatorCombine id="HasPowerDrainOrder">
        <CombineArray value="HasNodConstructionYardTrain"/>
        <CombineArray value="HasNodRefineryTrain"/>
        <CombineArray value="HasNodHandTrain"/>
        <CombineArray value="HasNodWarFactoryTrain"/>
        <CombineArray value="HasNodAirTowerTrain"/>
        <CombineArray value="HasNodUpgradePowerPlant"/>
    </CValidatorCombine> -->

    <CBehaviorBuff id="NodEnergyProduction">
        <InfoIcon value="Assets\Textures\btn-ability-protoss-chronoboost.dds"/>
        <EditorCategories value="AbilityorEffectType:Units,Race:Protoss"/>
        <Modification TimeScale="2"/>
        <BuffFlags index="DisableWhileUnderConstruction" value="1"/>
        <TimeScaleSource Value="Global"/>
        <BehaviorCategories index="Fast" value="1"/>
        <InfoFlags index="Hidden" value="0"/>
        <DisableValidatorArray value="GenetronPowerSupplyGE05"/>
    </CBehaviorBuff>


</Catalog>