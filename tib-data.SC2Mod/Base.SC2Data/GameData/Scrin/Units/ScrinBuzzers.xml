<Catalog>
    <CRequirement id="CBU_ScrinVehicleHasLinkedBuzzers">
        <NodeArray index="Show" Link="CBU_ScrinVehicleHasLinkedBuzzers"/>
    </CRequirement>
    <CRequirement id="NBU_ScrinBuzzersLinkedWithVehicleAndAttacking">
        <NodeArray index="Show" Link="NBU_ScrinBuzzersLinkedWithVehicleAndAttacking"/>
    </CRequirement>
    <CRequirement id="CBU_ScrinBuzzersLinkedWithVehicleAndAttacking">
        <NodeArray index="Show" Link="CBU_ScrinBuzzersLinkedWithVehicleAndAttacking"/>
    </CRequirement>
    <CRequirement id="CBU_ScrinVehicleHasLinkedAttackingBuzzers">
        <NodeArray index="Show" Link="CBU_ScrinVehicleHasLinkedAttackingBuzzers"/>
    </CRequirement>
    <CRequirementCountBehavior parent="CBU" id="CBU_ScrinVehicleHasLinkedBuzzers" behavior="ScrinVehicleHasLinkedBuzzers"/>
    <CRequirementCountBehavior parent="CBU" id="CBU_ScrinBuzzersLinkedWithVehicleAndAttacking" behavior="ScrinBuzzersLinkedWithVehicleAndAttacking"/>
    <CRequirementCountBehavior parent="CBU" id="CBU_ScrinVehicleHasLinkedAttackingBuzzers" behavior="ScrinVehicleHasLinkedAttackingBuzzers"/>
    <CRequirementNot parent="NBU" id="NBU_ScrinBuzzersLinkedWithVehicleAndAttacking" behavior="ScrinBuzzersLinkedWithVehicleAndAttacking"/>

    <CValidatorUnitCompareBehaviorCount id="HasScrinVehicleHasLinkedHostedBuzzers">
        <WhichUnit Value="Caster"/>
        <Behavior value="ScrinVehicleHasLinkedHostedBuzzers"/>
        <Compare value="NE"/>
    </CValidatorUnitCompareBehaviorCount>
    <CValidatorCompareTrackedUnitsCount id="HasIdleBuzzers">
        <Compare value="NE"/>
        <BehaviorLink value="ScrinBuzzerFusionBuzzers"/>
        <TrackedUnitValidatorArray value="TargetIsNotMovingOrAttacking"/>
    </CValidatorCompareTrackedUnitsCount>
    <CValidatorCombine id="TargetIsNotMovingOrAttacking">
        <Type value="And"/>
        <CombineArray value="TargetIsNotAttacking"/>
        <CombineArray value="TargetIsNotMoving"/>
    </CValidatorCombine>
    <CValidatorUnitOrderQueue id="TargetIsNotAttacking">
        <WhichUnit Value="Target"/>
        <AbilLink value="attack"/>
        <Find value="0"/>
    </CValidatorUnitOrderQueue>
    <CValidatorUnitOrderQueue id="TargetIsNotMoving">
        <WhichUnit Value="Target"/>
        <AbilLink value="move"/>
        <Find value="0"/>
    </CValidatorUnitOrderQueue>
    <CValidatorCombine id="CasterIsNotMovingOrAttacking">
        <Type value="And"/>
        <CombineArray value="CasterIsNotAttacking"/>
        <CombineArray value="CasterIsNotMoving"/>
    </CValidatorCombine>
    <CValidatorUnitOrderQueue id="CasterIsNotAttacking">
        <WhichUnit Value="Caster"/>
        <AbilLink value="attack"/>
        <Find value="0"/>
    </CValidatorUnitOrderQueue>
    <CValidatorUnitOrderQueue id="CasterIsNotMoving">
        <WhichUnit Value="Caster"/>
        <AbilLink value="move"/>
        <Find value="0"/>
    </CValidatorUnitOrderQueue>

    <!--Buzzers: Tracks Linked Vehicle for Buzzers-->
    <CBehaviorUnitTracker id="ScrinBuzzerFusionVehicle">
        <InfoFlags index="Hidden" value="1"/>
        <EditorCategories value="Race:Nod,AbilityorEffectType:Units"/>
    </CBehaviorUnitTracker>

    <!--Vehicle: Tracks Linked Buzzers for Vehicle -->
    <CBehaviorUnitTracker id="ScrinBuzzerFusionBuzzers">
        <InfoFlags index="Hidden" value="1"/>
        <EditorCategories value="Race:Nod,AbilityorEffectType:Units"/>
    </CBehaviorUnitTracker>

    <!--Buzzers: Indicates that Buzzers are linked with Vehicle and currently in attack order. -->
    <CBehaviorBuff id="ScrinBuzzersLinkedWithVehicleAndAttacking">
        <InfoIcon value="Assets\icons\scrin\btn-scrin-unit-seeker.dds"/>
        <Period value="0.0625"/>
        <PeriodicEffect value="ScrinFuseWithLinkedVehicleETU"/>
    </CBehaviorBuff>
    <!-- Periodically try to return to linked vehicle if Buzzers has no orders-->
    <CEffectEnumTrackedUnits id="ScrinFuseWithLinkedVehicleETU">
        <ValidatorArray value="CasterHasNoOrders"/>
        <BehaviorLink value="ScrinBuzzerFusionVehicle"/>
        <Effect value="ScrinBuzzersMoveToLinkedVehicleIO"/>
    </CEffectEnumTrackedUnits>
    <CEffectIssueOrder id="ScrinBuzzersMoveToLinkedVehicleIO">
        <Abil value="move"/>
        <WhichUnit Value="Caster"/>
        <Target Effect="ScrinBuzzersMoveToLinkedVehicleIO" Value="TargetUnit"/>
    </CEffectIssueOrder>
    <CValidatorUnitCompareBehaviorCount id="HasScrinBuzzersLinkedWithVehicleAndAttacking">
        <WhichUnit Value="Caster"/>
        <Behavior value="ScrinBuzzersLinkedWithVehicleAndAttacking"/>
        <Compare value="NE"/>
    </CValidatorUnitCompareBehaviorCount>

    <!--Buzzers: Indicates that Buzzers are linked with Vehicle and Hosted with it. Hosted Buzzers only follow linked vehicle. -->
    <CBehaviorBuff id="ScrinBuzzersLinkedWithVehicleAndFused">
        <InfoFlags index="Hidden" value="1"/>
        <EditorCategories value="AbilityorEffectType:Units,Race:Keiron"/>
        <Modification>
            <ModifyFlags index="DisableAbils" value="1"/>
            <ModifyFlags index="SuppressMoving" value="1"/>
            <StateFlags index="NoDraw" value="1"/>
            <StateFlags index="Invulnerable" value="1"/>
            <StateFlags index="Uncommandable" value="1"/>
            <StateFlags index="Unselectable" value="1"/>
            <StateFlags index="Untargetable" value="1"/>
        </Modification>
    </CBehaviorBuff>
    <CValidatorUnitCompareBehaviorCount id="HasScrinBuzzersLinkedWithVehicleAndFused">
        <WhichUnit Value="Caster"/>
        <Behavior value="ScrinBuzzersLinkedWithVehicleAndFused"/>
        <Compare value="NE"/>
    </CValidatorUnitCompareBehaviorCount>

    <!--Vehicle: Indicates that vehicle has linked Buzzers-->
    <CBehaviorBuff id="ScrinVehicleHasLinkedBuzzers">
        <InitialEffect value="ScrinCV@IE"/>
        <InfoIcon value="Assets\icons\scrin\btn-scrin-unit-buzzers.dds"/>
        <MaxStackCount value="0"/>
        <RemoveValidatorArray value="ScrinBuzzersLinkedWithVehicle"/>
        <RefreshEffect value="ScrinCV@IE"/>
        <FinalEffect value="ScrinCV@FE"/>
    </CBehaviorBuff>
    <CEffectSet id="ScrinCV@IE">
        <EffectArray value="ScrinCV@AK"/>
        <EffectArray value="ScrinCV@TP"/>
        <EffectArray value="ScrinVehicleHasLinkedHostedBuzzersAB"/>
    </CEffectSet>
    <CEffectCreatePersistent id="ScrinCV@FE">
        <WhichLocation Value="TargetUnit"/>
        <PeriodCount value="8"/>
        <PeriodicEffectArray value="ScrinCV@RK"/>
        <PeriodicEffectArray value="ScrinBuzzersLinkedWithVehicleAndFusedRB"/>
        <PeriodicEffectArray value="ScrinBuzzersLinkedWithVehicleAndAttackingRB"/>
        <PeriodicEffectArray value="ScrinVehicleHasLinkedHostedBuzzersRB"/>
        <PeriodicEffectArray value="ScrinVehicleHasLinkedAttackingBuzzersRB"/>
        <PeriodicEffectArray value="ScrinBuzzerFusionVehicleRTU"/>
        <PeriodicEffectArray value="ScrinBuzzerFusionBuzzersRTU"/>
        <PeriodicEffectArray value="FuseUnfuseCargoSuicide"/>
        <FinalEffect value="FuseUnfuseSelectionCooldown"/>
        <ExpireDelay value="0.5"/>
    </CEffectCreatePersistent>
    <!--check if unit still linked-->
    <CValidatorCombine id="ScrinBuzzersLinkedWithVehicle">
        <Type value="Or"/>
        <CombineArray value="HasScrinBuzzersLinkedWithVehicleAndFused"/>
        <CombineArray value="HasScrinBuzzersLinkedWithVehicleAndAttacking"/>
    </CValidatorCombine>

    <!--Vehicle: Indicates that vehicle has linked buzzers which are currently Fused with the Host-->
    <CBehaviorBuff id="ScrinVehicleHasLinkedHostedBuzzers">
        <InfoIcon value="Assets\icons\scrin\btn-scrin-unit-buzzers.dds"/>
        <InfoFlags index="Hidden" value="1"/>
        <MaxStackCount value="0"/>
    </CBehaviorBuff>
    <!--Model attachment. Original unit model will be hidden while hosted-->
    <CActorSiteOpLocalOffset id="ScrinCV@SO">
        <LocalOffset value="0.000000,0.000000,-0.5"/>
    </CActorSiteOpLocalOffset>
    <CActorModel id="ScrinCV@MA" parent="ModelAddition">
        <Inherits index="BaseModelScale" value="0"/>
        <Inherits index="Scale" value="0"/>
        <Inherits index="TintColor" value="0"/>
        <On Terms="Behavior.ScrinVehicleHasLinkedHostedBuzzers.On" Send="Create"/>
        <On Terms="Behavior.ScrinVehicleHasLinkedHostedBuzzers.Off" Send="AnimBracketStop BSD"/>
        <HostSiteOps Ops="SOpAttachCenter ScrinCV@SO"/>
        <AutoScaleFactor value="1"/>
        <Model value="ScrinBuzzers"/>
    </CActorModel>

    <!--Vehicle: Indicates that vehicle has linked buzzers which are currently in attacking order -->
    <CBehaviorBuff id="ScrinVehicleHasLinkedAttackingBuzzers">
        <InfoFlags index="Hidden" value="1"/>
        <InfoIcon value="Assets\icons\scrin\btn-scrin-unit-buzzers.dds"/>
        <MaxStackCount value="0"/>
    </CBehaviorBuff>

    <!--Buzzers: Fuse Buzzers with Vehicle-->
    <CAbilEffectTarget id="ScrinBuzzersCombineWithVehicle">
        <EditorCategories value="AbilityorEffectType:Units,Race:Keiron"/>
        <Range value="1"/>
        <CmdButtonArray index="Execute" DefaultButtonFace="ScrinBuzzersCombineWithVehicle" Requirements="NBU_ScrinBuzzersLinkedWithVehicleAndAttacking"/>
        <Flags index="AllowMovement" value="1"/>
        <Flags index="NoDeceleration" value="1"/>
        <Cost>
            <Cooldown TimeUse="5"/>
        </Cost>
        <TargetFilters value="-;Self,Ally,Neutral,Enemy,Structure,Missile,Stasis,Dead,Hidden"/>
        <AINotifyEffect value="ScrinVehicleHasLinkedBuzzersAB"/>
        <Arc value="360"/>
    </CAbilEffectTarget>
    <CEffectSet id="ScrinBuzzersCombineWithVehicle">
        <TargetLocationType value="Unit"/>
        <ValidatorArray value="ScrinCanCombineWithBuzzers"/>
        <ValidatorArray value="ScrinVehicleHasLinkedBuzzersLT2"/>
        <EffectArray value="ScrinBuzzersLinkedWithVehicleAndFusedABCaster"/>
        <EffectArray value="ScrinVehicleHasLinkedBuzzersAB"/>
        <EffectArray value="ScrinCV@DeselectBuzzers"/>
        <EffectArray value="ScrinBuzzerFusionVehicleATU"/>
        <EffectArray value="ScrinBuzzerFusionBuzzersATU"/>
    </CEffectSet>
    <!--Validate that target unit can combine with Buzzers-->
    <CValidatorUnitAbil id="ScrinCanCombineWithBuzzers">
        <ResultFailed value="Error,ErrorText/ScrinCanCombineWithBuzzers"/>
        <Find value="1"/>
        <AbilLink value="ScrinUncombineWithBuzzers"/>
    </CValidatorUnitAbil>
    <!--Set Limits For Linked Buzzers -->
    <CValidatorUnitCompareBehaviorCount id="ScrinVehicleHasLinkedBuzzersLT2">
        <ResultFailed value="Error,ErrorText/ScrinVehicleCanOnlyHave2LinkedBuzzers"/>
        <WhichUnit Value="Target"/>
        <Behavior value="ScrinVehicleHasLinkedBuzzers"/>
        <Compare value="LT"/>
        <Value value="1"/>
    </CValidatorUnitCompareBehaviorCount>

    <!--Buzzers: Unfuse Buzzers from the Vehicle-->
    <CAbilEffectInstant id="ScrinUncombineBuzzersFromVehicle">
        <Flags index="Transient" value="1"/>
        <CmdButtonArray index="Execute" DefaultButtonFace="ScrinUncombineBuzzersFromVehicle" Requirements="CBU_ScrinBuzzersLinkedWithVehicleAndAttacking">
            <Flags index="ToSelection" value="1"/>
        </CmdButtonArray>
        <TargetFilters value="-;Ally,Neutral,Enemy,Structure,Stasis,Dead,Hidden"/>
        <AINotifyEffect value="ScrinBuzzersLinkedWithVehicleAndAttackingRB"/>
    </CAbilEffectInstant>
    <CEffectSet id="ScrinUncombineBuzzersFromVehicle">
        <EffectArray value="ScrinBuzzersLinkedWithVehicleAndAttackingRB"/>
    </CEffectSet>

    <!--Vehicle: Unfuse Buzzers from the Vehicle-->
    <CAbilEffectInstant id="ScrinUncombineWithBuzzers">
        <EditorCategories value="AbilityorEffectType:Units,Race:Keiron"/>
        <Flags index="Transient" value="1"/>
        <CmdButtonArray index="Execute" DefaultButtonFace="ScrinUncombineWithBuzzers" Requirements="CBU_ScrinVehicleHasLinkedBuzzers">
            <Flags index="ToSelection" value="1"/>
        </CmdButtonArray>
        <TargetFilters value="-;Ally,Neutral,Enemy,Structure,Stasis,Dead,Hidden"/>
        <AINotifyEffect value="ScrinVehicleHasLinkedBuzzersRB"/>
    </CAbilEffectInstant>
    <CEffectSet id="ScrinUncombineWithBuzzers">
        <EffectArray value="ScrinVehicleHasLinkedBuzzersRB"/>
    </CEffectSet>
    <!--Kill buzzers if host was killed inside transport-->
    <CEffectDamage id="FuseUnfuseCargoSuicide">
        <ValidatorArray value="IsHidden"/>
        <ImpactLocation Value="CasterUnit"/>
        <Flags index="Kill" value="1"/>
    </CEffectDamage>

    <!---Vehicle: Set Linked Buzzers into Attack Order-->
    <CAbilEffectTarget id="ScrinUseFusedBuzzers">
        <Flags index="Transient" value="1"/>
        <Range value="8"/>
        <CmdButtonArray index="Execute" DefaultButtonFace="ScrinBuzzers" Requirements="CBU_ScrinVehicleHasLinkedBuzzers"/>
        <Flags index="AllowMovement" value="1"/>
        <Flags index="NoDeceleration" value="1"/>
        <TargetFilters value="Ground,Visible;Missile,Stasis,Dead,Hidden,Invulnerable"/>
        <Arc value="360"/>
        <Flags index="AutoCast" value="1"/>
        <Flags index="AutoCastOn" value="1"/>
        <AutoCastFilters value="Ground,Light,Visible;Player,Ally,Neutral,Missile,Stasis,Dead,Hidden,Invulnerable"/>
        <AutoCastRange value="8"/>
        <AutoCastValidatorArray value="HasIdleBuzzers"/>
    </CAbilEffectTarget>
    <CEffectSet id="ScrinUseFusedBuzzers">
        <EffectArray value="ScrinUseFusedBuzzers@ETU"/>
        <TargetLocationType value="UnitOrPoint"/>
    </CEffectSet>
    <CEffectEnumTrackedUnits id="ScrinUseFusedBuzzers@ETU">
        <BehaviorLink value="ScrinBuzzerFusionBuzzers"/>
        <Effect value="ScrinUseFusedBuzzers@Set"/>
    </CEffectEnumTrackedUnits>
    <CEffectSet id="ScrinUseFusedBuzzers@Set">
        <TargetLocationType value="UnitOrPoint"/>
        <EffectArray value="ScrinVehicleHasLinkedAttackingBuzzersABCaster"/>
        <EffectArray value="ScrinVehicleHasLinkedHostedBuzzersRBCaster"/>
        <EffectArray value="ScrinUseFusedBuzzersRK"/>
        <EffectArray value="ScrinUseFusedBuzzersRB"/>
        <EffectArray value="ScrinUseFusedBuzzersAB"/>
        <EffectArray value="ScrinUseFusedBuzzersIO"/>
    </CEffectSet>
    <CEffectRemoveBehavior id="ScrinVehicleHasLinkedHostedBuzzersRBCaster">
        <WhichUnit Value="Caster"/>
        <BehaviorLink value="ScrinVehicleHasLinkedHostedBuzzers"/>
        <Count value="1"/>
    </CEffectRemoveBehavior>
    <CEffectRemoveBehavior id="ScrinUseFusedBuzzersRB">
        <WhichUnit Effect="ScrinUseFusedBuzzersAttackCP"/>
        <BehaviorLink value="ScrinBuzzersLinkedWithVehicleAndFused"/>
    </CEffectRemoveBehavior>
    <CEffectApplyBehavior id="ScrinUseFusedBuzzersAB">
        <WhichUnit Effect="ScrinUseFusedBuzzersAttackCP"/>
        <Behavior value="ScrinBuzzersLinkedWithVehicleAndAttacking"/>
    </CEffectApplyBehavior>
    <CEffectIssueOrder id="ScrinUseFusedBuzzersIO">
        <Abil value="attack"/>
        <WhichUnit Effect="ScrinUseFusedBuzzersAttackCP"/>
        <Target Effect="ScrinUseFusedBuzzers" Value="TargetUnitOrPoint"/>
    </CEffectIssueOrder>

    <!---Vehicle: Call back Linked attacking Buzzers -->
    <CAbilEffectInstant id="ScrinCallbackFusedBuzzers">
        <Flags index="Transient" value="1"/>
        <CmdButtonArray index="Execute" DefaultButtonFace="ScrinCallbackFusedBuzzers" Requirements="CBU_ScrinVehicleHasLinkedAttackingBuzzers"/>
        <Flags index="AllowMovement" value="1"/>
        <Flags index="NoDeceleration" value="1"/>
        <Arc value="360"/>
    </CAbilEffectInstant>
    <CEffectSet id="ScrinCallbackFusedBuzzers">
        <EffectArray value="ScrinCallbackFusedBuzzers@ETU"/>
        <TargetLocationType value="UnitOrPoint"/>
    </CEffectSet>
    <CEffectEnumTrackedUnits id="ScrinCallbackFusedBuzzers@ETU">
        <BehaviorLink value="ScrinBuzzerFusionBuzzers"/>
        <Effect value="ScrinCallbackFusedBuzzers@Set"/>
    </CEffectEnumTrackedUnits>
    <CEffectSet id="ScrinCallbackFusedBuzzers@Set">
        <EffectArray value="ScrinCallbackFusedBuzzers@IO"/>
    </CEffectSet>
    <CEffectIssueOrder id="ScrinCallbackFusedBuzzers@IO">
        <Abil value="ScrinBuzzersFuseBack"/>
        <WhichUnit Effect="ScrinCallbackFusedBuzzers@Set"/>
    </CEffectIssueOrder>

    <!--Buzzers: Fuse Buzzers with its linked Vehicle -->
    <CAbilEffectInstant id="ScrinBuzzersFuseBackEI">
        <Flags index="Transient" value="1"/>
        <CmdButtonArray index="Execute" DefaultButtonFace="ScrinBuzzers" Requirements="CBU_ScrinBuzzersLinkedWithVehicleAndAttacking"/>
        <Flags index="AllowMovement" value="1"/>
        <Flags index="NoDeceleration" value="1"/>
        <Arc value="360"/>
        <Flags index="AutoCast" value="1"/>
        <Flags index="AutoCastOn" value="1"/>
        <AutoCastFilters value="-;Self,Player,Ally,Neutral,Structure,Missile,Stasis,Dead,Hidden"/>
        <AutoCastRange value="1"/>
        <AutoCastValidatorArray value="CasterIsNotMovingOrAttacking"/>
        <AutoCastValidatorArray value="HasScrinBuzzersLinkedWithVehicleAndAttacking"/>
    </CAbilEffectInstant>
    <CEffectEnumTrackedUnits id="ScrinBuzzersFuseBackEI">
        <BehaviorLink value="ScrinBuzzerFusionVehicle"/>
        <Effect value="ScrinBuzzersFuseBackIO"/>
    </CEffectEnumTrackedUnits>
    <CEffectIssueOrder id="ScrinBuzzersFuseBackIO">
        <Abil value="ScrinBuzzersFuseBack"/>
        <WhichUnit Value="Caster"/>
        <Target Effect="ScrinBuzzersFuseBackIO" Value="TargetUnit"/>
    </CEffectIssueOrder>

    <!--Buzzers: Fuse Buzzers with their Linked Vehicle (not clickable, only used with ScrinBuzzersFuseBackEI)-->
    <CAbilEffectTarget id="ScrinBuzzersFuseBack">
        <Range value="0.1"/>
        <CmdButtonArray index="Execute" DefaultButtonFace="ScrinBuzzersFuseBack" Requirements="CBU_ScrinBuzzersLinkedWithVehicleAndAttacking"/>
        <Flags index="AllowMovement" value="1"/>
        <Flags index="NoDeceleration" value="1"/>
        <TargetFilters value="Ground,Visible;Self,Ally,Neutral,Enemy,Structure,Missile,Stasis,Dead,Hidden"/>
        <Arc value="360"/>
    </CAbilEffectTarget>
    <CEffectSet id="ScrinBuzzersFuseBack">
        <TargetLocationType value="Unit"/>
        <EffectArray value="ScrinBuzzersLinkedWithVehicleAndAttackingRB"/>
        <EffectArray value="ScrinVehicleHasLinkedAttackingBuzzersRB"/>
        <EffectArray value="ScrinVehicleHasLinkedHostedBuzzersAB"/>
        <EffectArray value="ScrinCV@AK"/>
        <EffectArray value="ScrinCV@TP"/>
        <EffectArray value="ScrinBuzzersLinkedWithVehicleAndFusedABCaster"/>
        <EffectArray value="ScrinCV@DeselectBuzzers"/>
    </CEffectSet>

    <!--Follow Vehicle Using Kinetics (Optional)-->
    <CEffectApplyKinetic id="ScrinCV@AK">
        <ImpactUnit Value="Caster"/>
        <Kinetic value="FollowTargetPosition"/>
    </CEffectApplyKinetic>
    <CEffectRemoveKinetic id="ScrinCV@RK">
        <EditorCategories value="Race:Keiron"/>
        <KineticLink value="FollowTargetPosition"/>
        <ImpactUnit Value="Caster"/>
    </CEffectRemoveKinetic>
    <CEffectRemoveKinetic id="ScrinUseFusedBuzzersRK">
        <KineticLink value="FollowTargetPosition"/>
        <ImpactUnit Effect="ScrinUseFusedBuzzersAttackCP"/>
    </CEffectRemoveKinetic>
    <CKineticFollow id="FollowTargetPosition">
        <Where Value="TargetUnit"/>
        <Follow value="Position"/>
    </CKineticFollow>
    <!--Follow Vehicle Using Teleport (Optional)-->
    <CEffectTeleport id="ScrinCV@TP">
        <WhichUnit Value="Caster"/>
        <MinDistance value="0"/>
        <TargetLocation Value="TargetUnit"/>
        <TeleportFlags index="TestFog" value="0"/>
    </CEffectTeleport>

    <CEffectRemoveBehavior id="ScrinVehicleHasLinkedHostedBuzzersRB">
        <BehaviorLink value="ScrinVehicleHasLinkedHostedBuzzers"/>
        <Count value="1"/>
    </CEffectRemoveBehavior>
    <CEffectRemoveBehavior id="ScrinVehicleHasLinkedAttackingBuzzersRB">
        <BehaviorLink value="ScrinVehicleHasLinkedAttackingBuzzers"/>
        <Count value="1"/>
    </CEffectRemoveBehavior>
    <CEffectRemoveBehavior id="ScrinVehicleHasLinkedBuzzersRB">
        <EditorCategories value="Race:Keiron"/>
        <BehaviorLink value="ScrinVehicleHasLinkedBuzzers"/>
        <Count value="1"/>
    </CEffectRemoveBehavior>
    <CEffectRemoveBehavior id="ScrinBuzzersLinkedWithVehicleAndFusedRB">
        <WhichUnit Value="Caster"/>
        <BehaviorLink value="ScrinBuzzersLinkedWithVehicleAndFused"/>
    </CEffectRemoveBehavior>
    <CEffectRemoveBehavior id="ScrinBuzzersLinkedWithVehicleAndAttackingRB">
        <WhichUnit Value="Caster"/>
        <BehaviorLink value="ScrinBuzzersLinkedWithVehicleAndAttacking"/>
    </CEffectRemoveBehavior>

    <CEffectApplyBehavior id="ScrinVehicleHasLinkedBuzzersAB">
        <Behavior value="ScrinVehicleHasLinkedBuzzers"/>
    </CEffectApplyBehavior>
    <CEffectApplyBehavior id="ScrinVehicleHasLinkedAttackingBuzzersABCaster">
        <WhichUnit Value="Caster"/>
        <Behavior value="ScrinVehicleHasLinkedAttackingBuzzers"/>
    </CEffectApplyBehavior>
    <CEffectApplyBehavior id="ScrinVehicleHasLinkedHostedBuzzersAB">
        <WhichUnit Value="Target"/>
        <Behavior value="ScrinVehicleHasLinkedHostedBuzzers"/>
    </CEffectApplyBehavior>
    <CEffectApplyBehavior id="ScrinBuzzersLinkedWithVehicleAndFusedAB">
        <WhichUnit Value="Target"/>
        <Behavior value="ScrinBuzzersLinkedWithVehicleAndFused"/>
    </CEffectApplyBehavior>
    <CEffectApplyBehavior id="ScrinBuzzersLinkedWithVehicleAndFusedABCaster">
        <WhichUnit Value="Caster"/>
        <Behavior value="ScrinBuzzersLinkedWithVehicleAndFused"/>
    </CEffectApplyBehavior>

    <CEffectAddTrackedUnit id="ScrinBuzzerFusionVehicleATU">
        <BehaviorLink value="ScrinBuzzerFusionVehicle"/>
        <TrackerUnit Value="Caster"/>
        <TrackedUnit Value="Target"/>
    </CEffectAddTrackedUnit>
    <CEffectAddTrackedUnit id="ScrinBuzzerFusionBuzzersATU">
        <BehaviorLink value="ScrinBuzzerFusionBuzzers"/>
        <TrackerUnit Value="Target"/>
    </CEffectAddTrackedUnit>

    <CEffectRemoveTrackedUnit id="ScrinBuzzerFusionVehicleRTU">
        <BehaviorLink value="ScrinBuzzerFusionVehicle"/>
        <TrackedUnit Value="Target"/>
    </CEffectRemoveTrackedUnit>
    <CEffectRemoveTrackedUnit id="ScrinBuzzerFusionBuzzersRTU">
        <BehaviorLink value="ScrinBuzzerFusionBuzzers"/>
        <TrackerUnit Value="Target"/>
    </CEffectRemoveTrackedUnit>

    <CEffectModifyUnit id="FuseUnfuseSelectionCooldown">
        <EditorCategories value="Race:Keiron"/>
        <ImpactUnit Value="Caster"/>
        <Cost Abil="ScrinUncombineWithBuzzers,Execute" CooldownOperation="Set" CooldownTimeUse="5"/>
        <SelectTransferUnit Value="Target"/>
    </CEffectModifyUnit>
    <CEffectModifyUnit id="ScrinCV@DeselectBuzzers">
        <SelectTransferUnit Value="Caster"/>
        <SelectTransferFlags index="DeselectSource" value="1"/>
    </CEffectModifyUnit>
    <CEffectModifyUnit id="FuseFusionCooldown">
        <EditorCategories value="Race:Keiron"/>
        <Cost Abil="ScrinUncombineWithBuzzers,Execute" CooldownOperation="Set" CooldownTimeUse="0.0625"/>
        <SelectTransferUnit Value="Caster"/>
        <SelectTransferFlags index="DeselectSource" value="1"/>
    </CEffectModifyUnit>



    <!--Units and Weapons-->
    <CUnit id="ScrinBuzzers" parent="ScrinInfantry">
<!--        <Collide index="Ground" value="0"/>-->
<!--        <Collide index="ForceField" value="0"/>-->
<!--        <Collide index="Locust" value="0"/>-->
<!--        <Collide index="Phased" value="1"/>-->
<!--        <Collide index="Structure" value="0"/>-->
<!--        <Collide index="Small" value="0"/>-->
        <LifeStart value="80"/>
        <LifeMax value="80"/>
        <Food value="1"/>
        <Speed value="3"/>
        <CostResource index="Minerals" value="50"/>
        <WeaponArray Link="ScrinBuzzersWeapon"/>
        <GlossaryPriority value="35"/>
        <BehaviorArray Link="ScrinBuzzerFusionVehicle"/>
        <AbilArray Link="ScrinBuzzersCombineWithVehicle"/>
        <AbilArray Link="ScrinBuzzersFuseBack"/>
        <AbilArray Link="ScrinBuzzersFuseBackEI"/>
        <AbilArray Link="ScrinUncombineBuzzersFromVehicle"/>
        <CardLayouts index="0">
            <LayoutButtons Face="ScrinBuzzersCombineWithVehicle" Type="AbilCmd" AbilCmd="ScrinBuzzersCombineWithVehicle,Execute" Row="2" Column="0"/>
            <LayoutButtons Face="ScrinBuzzersFuseBack" Type="AbilCmd" AbilCmd="ScrinBuzzersFuseBackEI,Execute" Row="2" Column="4"/>
            <LayoutButtons Face="ScrinUncombineBuzzersFromVehicle" Type="AbilCmd" AbilCmd="ScrinUncombineBuzzersFromVehicle,Execute" Row="1" Column="0"/>
        </CardLayouts>
        <LifeRegenDelay value="4"/>
        <LifeRegenRate value="2"/>
    </CUnit>
    <CWeaponLegacy parent="ScrinWeapon" id="ScrinBuzzersWeapon" icon="wireframe-scrin-unit-buzzers">
        <TargetFilters value="Visible,Ground;Missile,Stasis,Dead,Hidden,Invulnerable"/>
        <Range value="0.1"/>
        <Period value="1"/>
        <Effect value="ScrinBuzzersWeaponDamage"/>
        <DamagePoint value="0.2666"/>
    </CWeaponLegacy>
    <CEffectDamage parent="ScrinDamage" id="ScrinBuzzersWeaponDamage">
        <AttributeBonus index="Light" value="30"/>
        <Flags index="Notification" value="1"/>
        <Kind value="Melee"/>
        <Amount value="4"/>
        <SearchFlags index="OffsetByUnitRadius" value="1"/>
    </CEffectDamage>

    <!--Buzzer Hive-->
    <CUnit id="ScrinBuzzersSummoned" parent="ScrinBuzzers">
        <FlagArray index="Unselectable" value="1"/>
        <FlagArray index="AILifetime" value="1"/>
        <FlagArray index="ArmySelect" value="1"/>
        <AIEvalFactor value="0"/>
        <EditorFlags index="NoPlacement" value="1"/>
        <CostResource index="Minerals" value="0"/>
        <ScoreMake value="0"/>
        <ScoreKill value="0"/>
        <GlossaryCategory value=""/>
        <HotkeyCategory value=""/>
        <LifeRegenDelay value="4"/>
        <LifeRegenRate value="5"/>
    </CUnit>
    <CAbilQueue id="ScrinBuzzerHiveQueue">
        <EditorCategories value="Race:Neutral,AbilityorEffectType:Structures"/>
        <QueueSize value="3"/>
        <Flags index="Passive" value="1"/>
    </CAbilQueue>
    <CUnit id="ScrinBuzzerHive" parent="ScrinStructure">
        <BehaviorArray Link="CNCEnergyDrain5"/>
        <BehaviorArray Link="CNCDeployable"/>
        <FlagArray index="AIDefense" value="1"/>
        <LifeStart value="300"/>
        <LifeMax value="300"/>
        <Sight value="11"/>
        <CostResource index="Minerals" value="150"/>
        <RepairTime value="25"/>
        <AttackTargetPriority value="19"/>
        <AbilArray Link="attack"/>
        <AbilArray Link="stop"/>
        <AbilArray Link="ScrinBuzzerHiveHangar"/>
        <AbilArray Link="ScrinBuzzerHiveQueue"/>
        <EquipmentArray Weapon="ScrinBuzzerHiveDummy"/>
        <WeaponArray Link="ScrinBuzzerLaunch"/>
        <CardLayouts index="0">
            <LayoutButtons Face="AttackBuilding" Type="AbilCmd" AbilCmd="attack,Execute" Row="0" Column="4"/>
            <LayoutButtons Face="Stop" Type="AbilCmd" AbilCmd="stop,Stop" Row="0" Column="1"/>
            <LayoutButtons Face="ScrinBuzzers" Type="AbilCmd" AbilCmd="ScrinBuzzerHiveHangar,Ammo1" Row="2" Column="0"/>
        </CardLayouts>
        <Radius value="0.75"/>
        <SeparationRadius value="0.75"/>
        <Footprint value="Footprint2x2Contour"/>
        <PlacementFootprint value="Footprint2x2"/>
        <ScoreMake value="100"/>
        <ScoreKill value="100"/>
        <SubgroupPriority value="3"/>
        <MinimapRadius value="0.75"/>
        <GlossaryPriority value="300"/>
    </CUnit>
    <CWeaponLegacy parent="ScrinWeapon" id="ScrinBuzzerHiveDummy" icon="wireframe-scrin-unit-buzzers">
        <DisplayEffect value="ScrinBuzzersWeaponDamage"/>
        <TargetFilters value="Ground,Visible;Player,Ally,Neutral,Enemy"/>
        <DisplayAttackCount value="1"/>
        <Range value="8"/>
        <Arc value="360"/>
        <Period value="3"/>
        <Effect value="ScrinBuzzerHiveUM"/>
    </CWeaponLegacy>
    <CWeaponLegacy parent="ScrinWeapon" id="ScrinBuzzerLaunch" icon="wireframe-scrin-unit-buzzers">
        <TargetFilters value="Ground,Visible;Missile,Stasis,Dead,Hidden,Invulnerable"/>
        <Range value="8"/>
        <Arc value="360"/>
        <Period value="0.5"/>
        <Options index="Hidden" value="1"/>
        <Effect value="ScrinBuzzerLaunchPersistent"/>
        <DamagePoint value="0"/>
        <Backswing value="0"/>
        <DisplayEffect value="Carrier"/>
    </CWeaponLegacy>
    <CEffectCreatePersistent id="ScrinBuzzerLaunchPersistent">
        <EditorCategories value="Race:Protoss"/>
        <WhichLocation Value="TargetUnit"/>
        <TimeScaleSource Value="Caster"/>
        <Flags index="Channeled" value="1"/>
        <PeriodCount value="8"/>
        <PeriodicValidator value="CasterNotDead"/>
        <PeriodicEffectArray value="ScrinBuzzerHiveUM"/>
        <PeriodicPeriodArray value="0.375"/>
    </CEffectCreatePersistent>
    <CEffectUseMagazine id="ScrinBuzzerHiveUM">
        <EditorCategories value="Race:Protoss"/>
    </CEffectUseMagazine>
    <CRequirement id="ScrinBuzzerHiveArm">
        <NodeArray index="Use" Link="UQU_ScrinBuzzersSummoned_LT3"/>
    </CRequirement>
    <CRequirementCountUnit parent="UQU" id="UQU_ScrinBuzzersSummoned">
        <Count Link="ScrinBuzzersSummoned" State="QueuedOrBetterAtUnit"/>
        <Flags index="TechTreeCheat" value="0"/>
    </CRequirementCountUnit>
    <CRequirementLT id="UQU_ScrinBuzzersSummoned_LT3">
        <OperandArray index="0" value="UQU_ScrinBuzzersSummoned"/>
        <OperandArray index="1" value="3"/>
        <Tooltip value="RequirementNode/Tooltip/UQU_ScrinBuzzersSummoned_LT3"/>
    </CRequirementLT>
    <CAbilArmMagazine id="ScrinBuzzerHiveHangar">
        <EditorCategories value="Race:Protoss,AbilityorEffectType:Units"/>
        <AbilSetId value="CarrierHanger"/>
        <Leash value="12"/>
        <Flags index="Retarget" value="1"/>
        <EffectArray index="Death" value="InterceptorFate"/>
        <InfoArray index="Ammo1" Time="10" CountStart="1" Manage="Recall" Unit="ScrinBuzzersSummoned">
            <Charge Link="ScrinBuzzersSummoned" Location="Unit"/>
            <Button DefaultButtonFace="ScrinBuzzers" Requirements="ScrinBuzzerHiveArm">
                <Flags index="ToSelection" value="1"/>
            </Button>
            <Flags index="AutoBuild" value="1"/>
            <Flags index="LeashRetarget" value="1"/>
            <Flags index="AutoBuildOn" value="1"/>
            <Cooldown Link="ScrinTrainBuzzersSummoned" TimeUse="0.01"/>
        </InfoArray>
        <Alert value="TrainComplete"/>
        <MaxCount value="3"/>
    </CAbilArmMagazine>
</Catalog>