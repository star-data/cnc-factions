<Catalog>

    <!--Buzzers: Tracks Linked Vehicle for Buzzers-->
    <CBehaviorUnitTracker id="ScrinCombineHostTracker">
        <InfoFlags index="Hidden" value="1"/>
        <InfoIcon value="Assets\icons\scrin\btn-scrin-unit-seeker.dds"/>
    </CBehaviorUnitTracker>
    <CEffectAddTrackedUnit id="ScrinCombineHostTracker@ATU">
        <BehaviorLink value="ScrinCombineHostTracker"/>
        <TrackerUnit Value="Caster"/>
        <TrackedUnit Value="Target"/>
    </CEffectAddTrackedUnit>
    <CEffectRemoveTrackedUnit id="ScrinCombineHostTracker@RTU">
        <BehaviorLink value="ScrinCombineHostTracker"/>
        <TrackedUnit Value="Target"/>
    </CEffectRemoveTrackedUnit>

    <!--Vehicle: Tracks Linked Buzzers for Vehicle -->
    <CBehaviorUnitTracker id="ScrinCombineMinionTracker">
        <InfoIcon value="Assets\icons\scrin\btn-scrin-unit-buzzers.dds"/>
        <InfoFlags index="Hidden" value="1"/>
    </CBehaviorUnitTracker>
    <CEffectAddTrackedUnit id="ScrinCombineMinionTracker@ATU">
        <BehaviorLink value="ScrinCombineMinionTracker"/>
        <TrackerUnit Value="Target"/>
    </CEffectAddTrackedUnit>
    <CEffectRemoveTrackedUnit id="ScrinCombineMinionTracker@RTU">
        <BehaviorLink value="ScrinCombineMinionTracker"/>
        <TrackerUnit Value="Target"/>
    </CEffectRemoveTrackedUnit>
    
    <!--Buzzers: Indicates that Buzzers are linked with Vehicle and currently in attack order. -->
    <CBehaviorBuff id="ScrinMinionLinked">
        <InfoIcon value="Assets\icons\scrin\btn-scrin-unit-seeker.dds"/>
        <Period value="0.0625"/>
        <PeriodicEffect value="ScrinMinionLinked@ETU"/>
    </CBehaviorBuff>
    <!-- Periodically try to return to linked vehicle if Buzzers has no orders-->
    <CEffectEnumTrackedUnits id="ScrinMinionLinked@ETU">
        <ValidatorArray value="CasterHasNoOrders"/>
        <BehaviorLink value="ScrinCombineHostTracker"/>
        <Effect value="ScrinMinionLinked@IO"/>
    </CEffectEnumTrackedUnits>
    <CEffectIssueOrder id="ScrinMinionLinked@IO">
        <Abil value="move"/>
        <WhichUnit Value="Caster"/>
        <Target Effect="ScrinMinionLinked@IO" Value="TargetUnit"/>
    </CEffectIssueOrder>
    <CValidatorUnitCompareBehaviorCount id="IsScrinMinionLinked">
        <WhichUnit Value="Caster"/>
        <Behavior value="ScrinMinionLinked"/>
        <Compare value="NE"/>
    </CValidatorUnitCompareBehaviorCount>
    <CEffectRemoveBehavior id="ScrinMinionLinked@RB">
        <WhichUnit Value="Caster"/>
        <BehaviorLink value="ScrinMinionLinked"/>
    </CEffectRemoveBehavior>

    <!--Buzzers: Indicates that Buzzers are linked with Vehicle and Hosted with it. Hosted Buzzers only follow linked vehicle. -->
    <CBehaviorBuff id="ScrinMinionFused">
        <InfoIcon value="Assets\icons\scrin\btn-scrin-unit-seeker.dds"/>
        <InfoFlags index="Hidden" value="1"/>
        <Modification>
            <ModifyFlags index="DisableAbils" value="1"/>
            <ModifyFlags index="SuppressMoving" value="1"/>
            <StateFlags index="NoDraw" value="1"/>
            <StateFlags index="Invulnerable" value="1"/>
            <StateFlags index="Uncommandable" value="1"/>
            <StateFlags index="Unselectable" value="1"/>
            <StateFlags index="Untargetable" value="1"/>
        </Modification>
    </CBehaviorBuff>
    <CValidatorUnitCompareBehaviorCount id="IsScrinMinionFused">
        <WhichUnit Value="Caster"/>
        <Behavior value="ScrinMinionFused"/>
        <Compare value="NE"/>
    </CValidatorUnitCompareBehaviorCount>
    <CEffectRemoveBehavior id="ScrinMinionFused@RB">
        <WhichUnit Value="Caster"/>
        <BehaviorLink value="ScrinMinionFused"/>
    </CEffectRemoveBehavior>
    <CEffectApplyBehavior id="ScrinMinionFused@AB">
        <WhichUnit Value="Target"/>
        <Behavior value="ScrinMinionFused"/>
    </CEffectApplyBehavior>
    <CEffectApplyBehavior id="ScrinMinionFused@ABCaster">
        <WhichUnit Value="Caster"/>
        <Behavior value="ScrinMinionFused"/>
    </CEffectApplyBehavior>

    <!--Vehicle: Indicates that vehicle has linked Buzzers-->
    <CBehaviorBuff id="ScrinHostCombined">
        <InitialEffect value="ScrinHostCombined@IE"/>
        <InfoIcon value="Assets\icons\scrin\btn-scrin-unit-buzzers.dds"/>
        <MaxStackCount value="0"/>
        <RemoveValidatorArray value="IsScrinMinionCombined"/>
        <RefreshEffect value="ScrinHostCombined@IE"/>
        <FinalEffect value="ScrinHostCombined@FE"/>
    </CBehaviorBuff>
    <CEffectSet id="ScrinHostCombined@IE">
        <EffectArray value="ScrinHostCombined@TP"/>
        <EffectArray value="ScrinHostCombined@AK"/>
        <EffectArray value="ScrinCombine@DeselectMinion"/>
        <EffectArray value="ScrinHostFused@AB"/>
    </CEffectSet>
    <CEffectCreatePersistent id="ScrinHostCombined@FE">
        <WhichLocation Value="TargetUnit"/>
        <PeriodCount value="8"/>
        <PeriodicEffectArray value="ScrinHostCombined@RK"/>
        <PeriodicEffectArray value="ScrinMinionFused@RB"/>
        <PeriodicEffectArray value="ScrinMinionLinked@RB"/>
        <PeriodicEffectArray value="ScrinHostFused@RB"/>
        <PeriodicEffectArray value="ScrinHostLinked@RB"/>
        <PeriodicEffectArray value="ScrinCombineHostTracker@RTU"/>
        <PeriodicEffectArray value="ScrinCombineMinionTracker@RTU"/>
        <PeriodicEffectArray value="FuseUnfuseCargoSuicide"/>
        <FinalEffect value="ScrinCombine@SetCooldown"/>
        <ExpireDelay value="0.5"/>
    </CEffectCreatePersistent>
    <!--Kill buzzers if host was killed inside transport-->
    <CEffectDamage id="FuseUnfuseCargoSuicide">
        <ValidatorArray value="IsHidden"/>
        <ImpactLocation Value="CasterUnit"/>
        <Flags index="Kill" value="1"/>
    </CEffectDamage>
    <!--Follow Vehicle Using Kinetics (Optional)-->
    <CEffectApplyKinetic id="ScrinHostCombined@AK">
        <ImpactUnit Value="Caster"/>
        <Kinetic value="FollowTargetPosition"/>
    </CEffectApplyKinetic>
    <CEffectRemoveKinetic id="ScrinHostCombined@RK">
        <KineticLink value="FollowTargetPosition"/>
        <ImpactUnit Value="Caster"/>
    </CEffectRemoveKinetic>
    <!--Follow Vehicle Using Teleport (Optional)-->
    <CEffectTeleport id="ScrinHostCombined@TP">
        <WhichUnit Value="Caster"/>
        <MinDistance value="0"/>
        <TargetLocation Value="TargetUnit"/>
        <TeleportFlags index="TestFog" value="0"/>
    </CEffectTeleport>

    <!--check if unit still linked-->
    <CValidatorCombine id="IsScrinMinionCombined">
        <Type value="Or"/>
        <CombineArray value="IsScrinMinionFused"/>
        <CombineArray value="IsScrinMinionLinked"/>
    </CValidatorCombine>
    <CEffectApplyBehavior id="ScrinHostCombined@AB">
        <Behavior value="ScrinHostCombined"/>
    </CEffectApplyBehavior>
    <CEffectRemoveBehavior id="ScrinHostCombined@RB">
        <BehaviorLink value="ScrinHostCombined"/>
        <Count value="1"/>
    </CEffectRemoveBehavior>

    <!--Vehicle: Indicates that vehicle has linked buzzers which are currently Fused with the Host-->
    <CBehaviorBuff id="ScrinHostFused">
        <InfoIcon value="Assets\icons\scrin\btn-scrin-unit-buzzers.dds"/>
        <InfoFlags index="Hidden" value="1"/>
        <MaxStackCount value="0"/>
    </CBehaviorBuff>
    <!--Model attachment. Original unit model will be hidden while hosted-->
    <CActorSiteOpLocalOffset id="ScrinHostFused@SOpLO">
        <LocalOffset value="0.000000,0.000000,-0.5"/>
    </CActorSiteOpLocalOffset>
    <CActorModel id="ScrinHostFused@MA" parent="ModelAddition">
        <Inherits index="BaseModelScale" value="0"/>
        <Inherits index="Scale" value="0"/>
        <Inherits index="TintColor" value="0"/>
        <On Terms="Behavior.ScrinHostFused.On" Send="Create"/>
        <On Terms="Behavior.ScrinHostFused.Off" Send="AnimBracketStop BSD"/>
        <HostSiteOps Ops="SOpAttachCenter ScrinHostFused@SOpLO"/>
        <AutoScaleFactor value="1"/>
        <Model value="ScrinBuzzers"/>
    </CActorModel>
    <CEffectRemoveBehavior id="ScrinHostFused@RB">
        <BehaviorLink value="ScrinHostFused"/>
        <Count value="1"/>
    </CEffectRemoveBehavior>
    <CEffectApplyBehavior id="ScrinHostFused@AB">
        <WhichUnit Value="Target"/>
        <Behavior value="ScrinHostFused"/>
    </CEffectApplyBehavior>
    <CEffectRemoveBehavior id="ScrinHostFused@RBCaster">
        <WhichUnit Value="Caster"/>
        <BehaviorLink value="ScrinHostFused"/>
        <Count value="1"/>
    </CEffectRemoveBehavior>

    <!--Vehicle: Indicates that vehicle has linked buzzers which are currently in attacking order -->
    <CBehaviorBuff id="ScrinHostLinked">
        <InfoFlags index="Hidden" value="1"/>
        <InfoIcon value="Assets\icons\scrin\btn-scrin-unit-buzzers.dds"/>
        <MaxStackCount value="0"/>
    </CBehaviorBuff>
    <CEffectRemoveBehavior id="ScrinHostLinked@RB">
        <BehaviorLink value="ScrinHostLinked"/>
        <Count value="1"/>
    </CEffectRemoveBehavior>
    <CEffectApplyBehavior id="ScrinHostLinked@ABCaster">
        <WhichUnit Value="Caster"/>
        <Behavior value="ScrinHostLinked"/>
    </CEffectApplyBehavior>

    <!--Buzzers: Fuse Buzzers with Vehicle-->
    <CAbilEffectTarget id="ScrinCombine">
        <Range value="1"/>
        <CmdButtonArray index="Execute" DefaultButtonFace="ScrinCombine" Requirements="NBU_ScrinMinionLinked"/>
        <Flags index="AllowMovement" value="1"/>
        <Flags index="NoDeceleration" value="1"/>
        <Cost>
            <Cooldown TimeUse="5"/>
        </Cost>
        <TargetFilters value="-;Self,Ally,Neutral,Enemy,Structure,Missile,Stasis,Dead,Hidden"/>
        <AINotifyEffect value="ScrinHostCombined@AB"/>
        <Arc value="360"/>
    </CAbilEffectTarget>
    <CEffectSet id="ScrinCombine">
        <TargetLocationType value="Unit"/>
        <ValidatorArray value="ScrinCombine@HasScrinUncombine"/>
        <ValidatorArray value="ScrinCombine@CombineLimit"/>
        <EffectArray value="ScrinMinionFused@ABCaster"/>
        <EffectArray value="ScrinHostCombined@AB"/>
        <EffectArray value="ScrinCombine@DeselectMinion"/>
        <EffectArray value="ScrinCombineHostTracker@ATU"/>
        <EffectArray value="ScrinCombineMinionTracker@ATU"/>
    </CEffectSet>
    <!--Validate that target unit can combine with Buzzers-->
    <CValidatorUnitAbil id="ScrinCombine@HasScrinUncombine">
        <ResultFailed value="Error,ErrorText/ScrinCombine@WrongTarget"/>
        <Find value="1"/>
        <AbilLink value="ScrinHostUncombine"/>
    </CValidatorUnitAbil>
    <!--Set Limits For Linked Buzzers -->
    <CValidatorUnitCompareBehaviorCount id="ScrinCombine@CombineLimit">
        <ResultFailed value="Error,ErrorText/ScrinCombine@CombineLimit"/>
        <WhichUnit Value="Target"/>
        <Behavior value="ScrinHostCombined"/>
        <Compare value="LT"/>
        <Value value="1"/>
    </CValidatorUnitCompareBehaviorCount>
    <CEffectModifyUnit id="ScrinCombine@SetCooldown">
        <ImpactUnit Value="Caster"/>
        <Cost Abil="ScrinCombine,Execute" CooldownOperation="Set" CooldownTimeUse="5"/>
        <SelectTransferUnit Value="Target"/>
    </CEffectModifyUnit>
    <CEffectModifyUnit id="ScrinCombine@DeselectMinion">
        <SelectTransferUnit Value="Caster"/>
        <SelectTransferFlags index="DeselectSource" value="1"/>
    </CEffectModifyUnit>

    <!--Buzzers: Unfuse Buzzers from the Vehicle-->
    <CAbilEffectInstant id="ScrinMinionUncombine">
        <Flags index="Transient" value="1"/>
        <CmdButtonArray index="Execute" DefaultButtonFace="ScrinMinionUncombine" Requirements="CBU_ScrinMinionLinked">
            <Flags index="ToSelection" value="1"/>
        </CmdButtonArray>
        <TargetFilters value="-;Ally,Neutral,Enemy,Structure,Stasis,Dead,Hidden"/>
        <AINotifyEffect value="ScrinMinionLinked@RB"/>
    </CAbilEffectInstant>
    <CEffectSet id="ScrinMinionUncombine">
        <EffectArray value="ScrinMinionLinked@RB"/>
    </CEffectSet>

    <!--Vehicle: Unfuse Buzzers from the Vehicle-->
    <CAbilEffectInstant id="ScrinHostUncombine">
        <Flags index="Transient" value="1"/>
        <CmdButtonArray index="Execute" DefaultButtonFace="ScrinHostUncombine" Requirements="CBU_ScrinHostCombined">
            <Flags index="ToSelection" value="1"/>
        </CmdButtonArray>
        <TargetFilters value="-;Ally,Neutral,Enemy,Structure,Stasis,Dead,Hidden"/>
        <AINotifyEffect value="ScrinHostCombined@RB"/>
    </CAbilEffectInstant>
    <CEffectSet id="ScrinHostUncombine">
        <EffectArray value="ScrinHostCombined@RB"/>
    </CEffectSet>

    <!---Vehicle: Set Linked Buzzers into Attack Order-->
    <CAbilEffectTarget id="ScrinSendMinions">
        <Range value="15"/>
        <CmdButtonArray index="Execute" DefaultButtonFace="ScrinBuzzers" Requirements="CBU_ScrinHostCombined"/>
        <Flags index="AllowMovement" value="1"/>
        <Flags index="NoDeceleration" value="1"/>
        <TargetFilters value="Ground,Visible;Missile,Stasis,Dead,Hidden,Invulnerable"/>
        <Arc value="360"/>
        <Flags index="AutoCast" value="1"/>
        <Flags index="AutoCastOn" value="1"/>
        <AutoCastFilters value="Ground,Light,Visible;Player,Ally,Neutral,Missile,Stasis,Dead,Hidden,Invulnerable"/>
        <AutoCastRange value="8"/>
        <AutoCastValidatorArray value="HasIdleBuzzers"/>
    </CAbilEffectTarget>
    <CValidatorCompareTrackedUnitsCount id="HasIdleBuzzers">
        <Compare value="NE"/>
        <BehaviorLink value="ScrinCombineMinionTracker"/>
        <TrackedUnitValidatorArray value="TargetIsNotMovingOrAttacking"/>
    </CValidatorCompareTrackedUnitsCount>
    <CEffectSet id="ScrinSendMinions">
        <EffectArray value="ScrinSendMinions@ETU"/>
        <TargetLocationType value="UnitOrPoint"/>
    </CEffectSet>
    <CEffectEnumTrackedUnits id="ScrinSendMinions@ETU">
        <BehaviorLink value="ScrinCombineMinionTracker"/>
        <Effect value="ScrinSendMinions@Switch"/>
    </CEffectEnumTrackedUnits>
    <CEffectSwitch id="ScrinSendMinions@Switch">
        <CaseArray Validator="ScrinSendMinions@IsScrinMinionLinked" Effect="ScrinSendMinions@SetLinked"/>
        <CaseDefault value="ScrinSendMinions@SetFused"/>
    </CEffectSwitch>
    <CValidatorUnitCompareBehaviorCount id="ScrinSendMinions@IsScrinMinionLinked">
        <WhichUnit Effect="ScrinSendMinions@Set"/>
        <Behavior value="ScrinMinionLinked"/>
        <Compare value="NE"/>
    </CValidatorUnitCompareBehaviorCount>
    <CEffectSet id="ScrinSendMinions@SetFused">
        <TargetLocationType value="UnitOrPoint"/>
        <EffectArray value="ScrinHostLinked@ABCaster"/>
        <EffectArray value="ScrinHostFused@RBCaster"/>
        <EffectArray value="ScrinSendMinionsRK"/>
        <EffectArray value="ScrinSendMinionsRB"/>
        <EffectArray value="ScrinSendMinionsAB"/>
        <EffectArray value="ScrinSendMinionsIO"/>
    </CEffectSet>
    <CEffectSet id="ScrinSendMinions@SetLinked">
        <TargetLocationType value="UnitOrPoint"/>
        <EffectArray value="ScrinSendMinionsIO"/>
    </CEffectSet>
    <CEffectRemoveKinetic id="ScrinSendMinionsRK">
        <KineticLink value="FollowTargetPosition"/>
        <ImpactUnit Effect="ScrinSendMinions@Set"/>
    </CEffectRemoveKinetic>
    <CEffectRemoveBehavior id="ScrinSendMinionsRB">
        <WhichUnit Effect="ScrinSendMinions@Set"/>
        <BehaviorLink value="ScrinMinionFused"/>
    </CEffectRemoveBehavior>
    <CEffectApplyBehavior id="ScrinSendMinionsAB">
        <WhichUnit Effect="ScrinSendMinions@Set"/>
        <Behavior value="ScrinMinionLinked"/>
    </CEffectApplyBehavior>
    <CEffectIssueOrder id="ScrinSendMinionsIO">
        <Abil value="attack"/>
        <WhichUnit Effect="ScrinSendMinions@Set"/>
        <Target Effect="ScrinSendMinions" Value="TargetUnitOrPoint"/>
    </CEffectIssueOrder>

    <!---Vehicle: Call back Linked attacking Buzzers -->
    <CAbilEffectInstant id="ScrinHostRecallMinions">
        <Flags index="Transient" value="1"/>
        <CmdButtonArray index="Execute" DefaultButtonFace="ScrinHostRecallMinions" Requirements="CBU_ScrinVehicleHasLinkedAttackingBuzzers"/>
        <Flags index="AllowMovement" value="1"/>
        <Flags index="NoDeceleration" value="1"/>
        <Arc value="360"/>
    </CAbilEffectInstant>
    <CEffectSet id="ScrinHostRecallMinions">
        <EffectArray value="ScrinHostRecallMinions@ETU"/>
        <TargetLocationType value="UnitOrPoint"/>
    </CEffectSet>
    <CEffectEnumTrackedUnits id="ScrinHostRecallMinions@ETU">
        <BehaviorLink value="ScrinCombineMinionTracker"/>
        <Effect value="ScrinHostRecallMinions@Set"/>
    </CEffectEnumTrackedUnits>
    <CEffectSet id="ScrinHostRecallMinions@Set">
        <EffectArray value="ScrinHostRecallMinions@IO"/>
    </CEffectSet>
    <CEffectIssueOrder id="ScrinHostRecallMinions@IO">
        <Abil value="ScrinMinionRecallTargeted"/>
        <WhichUnit Effect="ScrinHostRecallMinions@Set"/>
    </CEffectIssueOrder>

    <!--Buzzers: Fuse Buzzers with its linked Vehicle -->
    <CAbilEffectInstant id="ScrinMinionRecall">
        <Flags index="Transient" value="1"/>
        <CmdButtonArray index="Execute" DefaultButtonFace="ScrinBuzzers" Requirements="CBU_ScrinMinionLinked"/>
        <Flags index="AllowMovement" value="1"/>
        <Flags index="NoDeceleration" value="1"/>
        <Arc value="360"/>
        <Flags index="AutoCast" value="1"/>
        <Flags index="AutoCastOn" value="1"/>
        <AutoCastFilters value="-;Self,Player,Ally,Neutral,Structure,Missile,Stasis,Dead,Hidden"/>
        <AutoCastRange value="1"/>
        <AutoCastValidatorArray value="CasterIsNotMovingOrAttacking"/>
        <AutoCastValidatorArray value="IsScrinMinionLinked"/>
    </CAbilEffectInstant>
    <CEffectEnumTrackedUnits id="ScrinMinionRecall">
        <BehaviorLink value="ScrinCombineHostTracker"/>
        <Effect value="ScrinMinionRecall@IO"/>
    </CEffectEnumTrackedUnits>
    <CEffectIssueOrder id="ScrinMinionRecall@IO">
        <Abil value="ScrinMinionRecallTargeted"/>
        <WhichUnit Value="Caster"/>
        <Target Effect="ScrinMinionRecall@IO" Value="TargetUnit"/>
    </CEffectIssueOrder>
    <!--Buzzers: Fuse Buzzers with their Linked Vehicle (not clickable, only used with ScrinMinionRecall)-->
    <CAbilEffectTarget id="ScrinMinionRecallTargeted">
        <Range value="0.1"/>
        <CmdButtonArray index="Execute" DefaultButtonFace="ScrinMinionRecallTargeted" Requirements="CBU_ScrinMinionLinked"/>
        <Flags index="AllowMovement" value="1"/>
        <Flags index="NoDeceleration" value="1"/>
        <TargetFilters value="Ground,Visible;Self,Ally,Neutral,Enemy,Structure,Missile,Stasis,Dead,Hidden"/>
        <Arc value="360"/>
    </CAbilEffectTarget>
    <CEffectSet id="ScrinMinionRecallTargeted">
        <TargetLocationType value="Unit"/>
        <EffectArray value="ScrinMinionLinked@RB"/>
        <EffectArray value="ScrinHostLinked@RB"/>
        <EffectArray value="ScrinHostFused@AB"/>
        <EffectArray value="ScrinHostCombined@TP"/>
        <EffectArray value="ScrinHostCombined@AK"/>
        <EffectArray value="ScrinMinionFused@ABCaster"/>
        <EffectArray value="ScrinCombine@DeselectMinion"/>
    </CEffectSet>

    <!--Requirements. used for buttons to show-->
    <CRequirement id="CBU_ScrinHostCombined">
        <NodeArray index="Show" Link="CBU_ScrinHostCombined"/>
    </CRequirement>
    <CRequirement id="NBU_ScrinMinionLinked">
        <NodeArray index="Show" Link="NBU_ScrinMinionLinked"/>
    </CRequirement>
    <CRequirement id="CBU_ScrinMinionLinked">
        <NodeArray index="Show" Link="CBU_ScrinMinionLinked"/>
    </CRequirement>
    <CRequirement id="CBU_ScrinVehicleHasLinkedAttackingBuzzers">
        <NodeArray index="Show" Link="CBU_ScrinVehicleHasLinkedAttackingBuzzers"/>
    </CRequirement>
    <!-- CBU - count behavior at unit GT 0 -->
    <CRequirementCountBehavior parent="CBU" id="CBU_ScrinHostCombined" behavior="ScrinHostCombined"/>
    <CRequirementCountBehavior parent="CBU" id="CBU_ScrinMinionLinked" behavior="ScrinMinionLinked"/>
    <CRequirementCountBehavior parent="CBU" id="CBU_ScrinVehicleHasLinkedAttackingBuzzers" behavior="ScrinHostLinked"/>
    <!-- CBU - count behavior at unit EQ 0 -->
    <CRequirementNot parent="NBU" id="NBU_ScrinMinionLinked" behavior="ScrinMinionLinked"/>

    <!--utility kinetic. used to follow linked host unit-->
    <CKineticFollow id="FollowTargetPosition">
        <Where Value="TargetUnit"/>
        <Follow value="Position"/>
    </CKineticFollow>
    <!--utility validators-->
    <CValidatorCombine id="TargetIsNotMovingOrAttacking">
        <Type value="And"/>
        <CombineArray value="TargetIsNotAttacking"/>
        <CombineArray value="TargetIsNotMoving"/>
    </CValidatorCombine>
    <CValidatorUnitOrderQueue id="TargetIsNotAttacking">
        <WhichUnit Value="Target"/>
        <AbilLink value="attack"/>
        <Find value="0"/>
    </CValidatorUnitOrderQueue>
    <CValidatorUnitOrderQueue id="TargetIsNotMoving">
        <WhichUnit Value="Target"/>
        <AbilLink value="move"/>
        <Find value="0"/>
    </CValidatorUnitOrderQueue>
    <CValidatorCombine id="CasterIsNotMovingOrAttacking">
        <Type value="And"/>
        <CombineArray value="CasterIsNotAttacking"/>
        <CombineArray value="CasterIsNotMoving"/>
    </CValidatorCombine>
    <CValidatorUnitOrderQueue id="CasterIsNotAttacking">
        <WhichUnit Value="Caster"/>
        <AbilLink value="attack"/>
        <Find value="0"/>
    </CValidatorUnitOrderQueue>
    <CValidatorUnitOrderQueue id="CasterIsNotMoving">
        <WhichUnit Value="Caster"/>
        <AbilLink value="move"/>
        <Find value="0"/>
    </CValidatorUnitOrderQueue>

    <!--Units and Weapons-->
    <CUnit id="ScrinBuzzers" parent="ScrinInfantry">
        <LifeStart value="80"/>
        <LifeMax value="80"/>
        <Food value="1"/>
        <Speed value="3"/>
        <CostResource index="Minerals" value="50"/>
        <WeaponArray Link="ScrinBuzzersWeapon"/>
        <GlossaryPriority value="35"/>
        <BehaviorArray Link="ScrinCombineHostTracker"/>
        <AbilArray Link="ScrinCombine"/>
        <AbilArray Link="ScrinMinionRecallTargeted"/>
        <AbilArray Link="ScrinMinionRecall"/>
        <AbilArray Link="ScrinMinionUncombine"/>
        <CardLayouts index="0">
            <LayoutButtons Face="ScrinCombine" Type="AbilCmd" AbilCmd="ScrinCombine,Execute" Row="2" Column="0"/>
            <LayoutButtons Face="ScrinMinionRecallTargeted" Type="AbilCmd" AbilCmd="ScrinMinionRecall,Execute" Row="2" Column="4"/>
            <LayoutButtons Face="ScrinMinionUncombine" Type="AbilCmd" AbilCmd="ScrinMinionUncombine,Execute" Row="1" Column="0"/>
        </CardLayouts>
        <LifeRegenDelay value="4"/>
        <LifeRegenRate value="2"/>
        <!--        <Collide index="Ground" value="0"/>-->
        <!--        <Collide index="ForceField" value="0"/>-->
        <!--        <Collide index="Locust" value="0"/>-->
        <!--        <Collide index="Phased" value="1"/>-->
        <!--        <Collide index="Structure" value="0"/>-->
        <!--        <Collide index="Small" value="0"/>-->
    </CUnit>
    <CWeaponLegacy parent="ScrinWeapon" id="ScrinBuzzersWeapon" icon="wireframe-scrin-unit-buzzers">
        <TargetFilters value="Visible,Ground;Missile,Stasis,Dead,Hidden,Invulnerable"/>
        <Range value="0.1"/>
        <Period value="1"/>
        <Effect value="ScrinBuzzersWeaponDamage"/>
        <DamagePoint value="0.2666"/>
    </CWeaponLegacy>
    <CEffectDamage parent="ScrinDamage" id="ScrinBuzzersWeaponDamage">
        <AttributeBonus index="Light" value="30"/>
        <Flags index="Notification" value="1"/>
        <Kind value="Melee"/>
        <Amount value="4"/>
        <SearchFlags index="OffsetByUnitRadius" value="1"/>
    </CEffectDamage>

    <!--Buzzer Hive-->
    <CUnit id="ScrinBuzzersSummoned" parent="ScrinBuzzers">
        <FlagArray index="Unselectable" value="1"/>
        <FlagArray index="AILifetime" value="1"/>
        <FlagArray index="ArmySelect" value="1"/>
        <AIEvalFactor value="0"/>
        <EditorFlags index="NoPlacement" value="1"/>
        <CostResource index="Minerals" value="0"/>
        <ScoreMake value="0"/>
        <ScoreKill value="0"/>
        <GlossaryCategory value=""/>
        <HotkeyCategory value=""/>
        <LifeRegenDelay value="4"/>
        <LifeRegenRate value="5"/>
    </CUnit>
    <CAbilQueue id="ScrinBuzzerHiveQueue">
        <QueueSize value="3"/>
        <Flags index="Passive" value="1"/>
    </CAbilQueue>
    <CUnit id="ScrinBuzzerHive" parent="ScrinStructure">
        <BehaviorArray Link="CNCEnergyDrain5"/>
        <BehaviorArray Link="CNCDeployable"/>
        <FlagArray index="AIDefense" value="1"/>
        <LifeStart value="300"/>
        <LifeMax value="300"/>
        <Sight value="11"/>
        <CostResource index="Minerals" value="150"/>
        <RepairTime value="25"/>
        <AttackTargetPriority value="19"/>
        <AbilArray Link="attack"/>
        <AbilArray Link="stop"/>
        <AbilArray Link="ScrinBuzzerHiveHangar"/>
        <AbilArray Link="ScrinBuzzerHiveQueue"/>
        <EquipmentArray Weapon="ScrinBuzzerHiveDummy"/>
        <WeaponArray Link="ScrinBuzzerLaunch"/>
        <CardLayouts index="0">
            <LayoutButtons Face="AttackBuilding" Type="AbilCmd" AbilCmd="attack,Execute" Row="0" Column="4"/>
            <LayoutButtons Face="Stop" Type="AbilCmd" AbilCmd="stop,Stop" Row="0" Column="1"/>
            <LayoutButtons Face="ScrinBuzzers" Type="AbilCmd" AbilCmd="ScrinBuzzerHiveHangar,Ammo1" Row="2" Column="0"/>
        </CardLayouts>
        <Radius value="0.75"/>
        <SeparationRadius value="0.75"/>
        <Footprint value="Footprint2x2Contour"/>
        <PlacementFootprint value="Footprint2x2"/>
        <ScoreMake value="100"/>
        <ScoreKill value="100"/>
        <SubgroupPriority value="3"/>
        <MinimapRadius value="0.75"/>
        <GlossaryPriority value="300"/>
    </CUnit>
    <CWeaponLegacy parent="ScrinWeapon" id="ScrinBuzzerHiveDummy" icon="wireframe-scrin-unit-buzzers">
        <DisplayEffect value="ScrinBuzzersWeaponDamage"/>
        <TargetFilters value="Ground,Visible;Player,Ally,Neutral,Enemy"/>
        <DisplayAttackCount value="1"/>
        <Range value="8"/>
        <Arc value="360"/>
        <Period value="3"/>
        <Effect value="ScrinBuzzerHiveUM"/>
    </CWeaponLegacy>
    <CWeaponLegacy parent="ScrinWeapon" id="ScrinBuzzerLaunch" icon="wireframe-scrin-unit-buzzers">
        <TargetFilters value="Ground,Visible;Missile,Stasis,Dead,Hidden,Invulnerable"/>
        <Range value="8"/>
        <Arc value="360"/>
        <Period value="0.5"/>
        <Options index="Hidden" value="1"/>
        <Effect value="ScrinBuzzerLaunchPersistent"/>
        <DamagePoint value="0"/>
        <Backswing value="0"/>
        <DisplayEffect value="Carrier"/>
    </CWeaponLegacy>
    <CEffectCreatePersistent id="ScrinBuzzerLaunchPersistent">
        <WhichLocation Value="TargetUnit"/>
        <TimeScaleSource Value="Caster"/>
        <Flags index="Channeled" value="1"/>
        <PeriodCount value="8"/>
        <PeriodicValidator value="CasterNotDead"/>
        <PeriodicEffectArray value="ScrinBuzzerHiveUM"/>
        <PeriodicPeriodArray value="0.375"/>
    </CEffectCreatePersistent>
    <CEffectUseMagazine id="ScrinBuzzerHiveUM">
    </CEffectUseMagazine>
    <CRequirement id="ScrinBuzzerHiveArm">
        <NodeArray index="Use" Link="UQU_ScrinBuzzersSummoned_LT3"/>
    </CRequirement>
    <CRequirementCountUnit parent="UQU" id="UQU_ScrinBuzzersSummoned">
        <Count Link="ScrinBuzzersSummoned" State="QueuedOrBetterAtUnit"/>
        <Flags index="TechTreeCheat" value="0"/>
    </CRequirementCountUnit>
    <CRequirementLT id="UQU_ScrinBuzzersSummoned_LT3">
        <OperandArray index="0" value="UQU_ScrinBuzzersSummoned"/>
        <OperandArray index="1" value="3"/>
        <Tooltip value="RequirementNode/Tooltip/UQU_ScrinBuzzersSummoned_LT3"/>
    </CRequirementLT>
    <CAbilArmMagazine id="ScrinBuzzerHiveHangar">
        <AbilSetId value="CarrierHanger"/>
        <Leash value="12"/>
        <Flags index="Retarget" value="1"/>
        <EffectArray index="Death" value="InterceptorFate"/>
        <InfoArray index="Ammo1" Time="10" CountStart="1" Manage="Recall" Unit="ScrinBuzzersSummoned">
            <Charge Link="ScrinBuzzersSummoned" Location="Unit"/>
            <Button DefaultButtonFace="ScrinBuzzers" Requirements="ScrinBuzzerHiveArm">
                <Flags index="ToSelection" value="1"/>
            </Button>
            <Flags index="AutoBuild" value="1"/>
            <Flags index="LeashRetarget" value="1"/>
            <Flags index="AutoBuildOn" value="1"/>
            <Cooldown Link="ScrinTrainBuzzersSummoned" TimeUse="0.01"/>
        </InfoArray>
        <Alert value="TrainComplete"/>
        <MaxCount value="3"/>
    </CAbilArmMagazine>
</Catalog>